name: Deploy to dev (SSH)   # ğŸ‘ˆ Ø§Ø³Ù… Ø§Ù„Ù€ Action (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ù…Ø§ ÙŠØ¤Ø«Ø±)

on:
  push:
    branches:
      - dev   # ğŸ‘ˆ Ø¹Ø¯Ù‘Ù„Ù‡Ø§ Ù„Ùˆ ØªØ³ØªØ®Ø¯Ù… branch Ø¢Ø®Ø± (Ù…Ø«Ù„Ø§Ù‹: main Ø£Ùˆ test)

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Deploy to AWS Ubuntu Server via SSH
        uses: appleboy/ssh-action@v0.1.10
        with:
          host: ${{ secrets.SERVER_IP }}        # ğŸ‘ˆ Ù„Ø§ ØªØ¹Ø¯Ù„Ù‡Ø§ Ù‡Ù†Ø§ØŒ Ø¹Ø¯Ù„Ù‡Ø§ Ù…Ù† Settings â†’ Secrets
          username: ${{ secrets.SERVER_USER }}  # ğŸ‘ˆ Ù„Ø§ ØªØ¹Ø¯Ù„Ù‡Ø§ Ù‡Ù†Ø§ØŒ Ø¹Ø¯Ù„Ù‡Ø§ Ù…Ù† Secrets
          key: ${{ secrets.SERVER_SSH_KEY }}    # ğŸ‘ˆ Ù„Ø§ ØªØ¹Ø¯Ù„Ù‡Ø§ Ù‡Ù†Ø§ØŒ Ø¹Ø¯Ù„Ù‡Ø§ Ù…Ù† Secrets
          script: |
            cd /var/www/moodle                  # ğŸ‘ˆ Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ù…Ø³Ø§Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³ÙŠØ±ÙØ± â€” Ø¹Ø¯Ù‘Ù„Ù‡ Ù„Ù…Ø³Ø§Ø± Ù…Ø´Ø±ÙˆØ¹Ùƒ
            git fetch origin dev                # ğŸ‘ˆ Ø¹Ø¯Ù‘Ù„ "dev" Ù„Ùˆ ØªØ³ØªØ®Ø¯Ù… Ø¨Ø±Ø§Ù†Ø´ Ø¢Ø®Ø±
            git reset --hard origin/dev         # ğŸ‘ˆ Ù†ÙØ³ Ø§Ù„Ø´ÙŠØ¡ØŒ Ù„Ùˆ Ø¨Ø±Ø§Ù†Ø´Ùƒ Ø§Ø³Ù…Ù‡ Ù…Ø®ØªÙ„Ù
            sudo systemctl reload apache2       # ğŸ‘ˆ Ù„Ùˆ ØªØ³ØªØ®Ø¯Ù… nginxØŒ ØºÙŠÙ‘Ø±Ù‡Ø§ Ø¥Ù„Ù‰:
                                                # sudo systemctl reload nginx
